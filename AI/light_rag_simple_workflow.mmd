flowchart TD
    A[AUTOSAR Document] --> B[Content Extraction]
    
    B --> B1[Extract Text]
    B --> B2[Extract Tables]
    B --> B3[Extract Images]
    
    B1 --> C[LightRAG Insert]
    B2 --> C
    B3 --> C
    
    C --> D[Text Processing]
    D --> E[Entity Extraction]
    D --> F[Relationship Extraction]
    D --> G[Text Summarization]
    
    E --> H[Knowledge Graph Construction]
    F --> H
    G --> H
    
    H --> I[Dual Storage System]
    I --> I1[Graph Database<br/>Entities & Relations]
    I --> I2[Vector Database<br/>Text Embeddings]
    
    %% Query Processing
    J[User Query] --> K[Query Processing]
    
    K --> L[Query Mode Selection]
    L --> L1[Local Mode<br/>Entity-focused]
    L --> L2[Global Mode<br/>Relationship-focused]
    L --> L3[Hybrid Mode<br/>Combined approach]
    L --> L4[Mix Mode<br/>Graph + Vector]
    L --> L5[Naive Mode<br/>Basic search]
    
    L1 --> M[Context Retrieval]
    L2 --> M
    L3 --> M
    L4 --> M
    L5 --> M
    
    M --> N[Local Context<br/>Entity descriptions]
    M --> O[Global Context<br/>Relationship descriptions]
    M --> P[Vector Context<br/>Semantic similarity]
    
    N --> Q[Context Assembly]
    O --> Q
    P --> Q
    
    Q --> R[LLM Response Generation]
    R --> S[Final Answer]
    
    %% Storage connections
    I1 -.-> M
    I2 -.-> M
    
    %% LightRAG Processing Indicator
    note1[Everything from LightRAG Insert<br/>onwards is handled by<br/>LightRAG Open Source]
    
    C -.-> note1
    
    style A fill:#e1f5fe
    style H fill:#fff3e0
    style I fill:#f3e5f5
    style S fill:#e8f5e8
    style L4 fill:#ffebee